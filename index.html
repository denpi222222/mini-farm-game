<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Стратегия-Ферма</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas {
      display: block;
      background-color: #87CEEB; /* Небесно-голубой фон */
    }
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      font-family: Arial, sans-serif;
      color: #fff;
    }
    #ui button {
      padding: 10px 20px;
      font-size: 16px;
      margin-right: 10px;
    }
    #ui #inventory {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="800" height="600"></canvas>
  <div id="ui">
    <button id="plantButton">Посадить семена</button>
    <button id="harvestButton">Собрать урожай</button>
    <div id="inventory">
      <p>Семена: <span id="seedsCount">10</span></p>
      <p>Урожай: <span id="cropsCount">0</span></p>
    </div>
  </div>
  <script>
    // Настройка Canvas
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // Размеры поля
    const TILE_SIZE = 40;
    const FIELD_WIDTH = 10;
    const FIELD_HEIGHT = 10;

    // Игровые переменные
    let seeds = 10;
    let crops = 0;

    const field = [];
    for (let y = 0; y < FIELD_HEIGHT; y++) {
      field[y] = [];
      for (let x = 0; x < FIELD_WIDTH; x++) {
        field[y][x] = {
          stage: 0, // 0 - пусто, 1-3 - рост растения, 4 - готово к сбору
          growthTime: 0,
        };
      }
    }

    // Загрузка изображений
    const images = {};
    const loadImages = () => {
      const imageSources = {
        soil: 'https://i.imgur.com/6RLzxWe.png', // Изображение земли
        sprout: 'https://i.imgur.com/8u1j1HU.png', // Росток
        plant: 'https://i.imgur.com/1f9Dk5z.png', // Растение
        harvest: 'https://i.imgur.com/WQ3ZJUA.png', // Готовое к сбору
      };
      const promises = [];
      for (const key in imageSources) {
        images[key] = new Image();
        images[key].src = imageSources[key];
        promises.push(new Promise((resolve) => {
          images[key].onload = resolve;
        }));
      }
      return Promise.all(promises);
    };

    // Обновление интерфейса
    const updateUI = () => {
      document.getElementById('seedsCount').innerText = seeds;
      document.getElementById('cropsCount').innerText = crops;
    };

    // Рисование поля
    const drawField = () => {
      for (let y = 0; y < FIELD_HEIGHT; y++) {
        for (let x = 0; x < FIELD_WIDTH; x++) {
          const tile = field[y][x];
          ctx.drawImage(images.soil, x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
          if (tile.stage > 0) {
            let image;
            if (tile.stage === 1) image = images.sprout;
            else if (tile.stage === 2) image = images.plant;
            else if (tile.stage >= 3) image = images.harvest;
            ctx.drawImage(image, x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
          }
          ctx.strokeStyle = '#000';
          ctx.strokeRect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
        }
      }
    };

    // Обновление роста растений
    const updatePlants = (deltaTime) => {
      for (let y = 0; y < FIELD_HEIGHT; y++) {
        for (let x = 0; x < FIELD_WIDTH; x++) {
          const tile = field[y][x];
          if (tile.stage > 0 && tile.stage < 3) {
            tile.growthTime += deltaTime;
            if (tile.growthTime >= 5) {
              tile.stage++;
              tile.growthTime = 0;
            }
          }
        }
      }
    };

    // Основной цикл игры
    let lastTime = 0;
    const gameLoop = (time = 0) => {
      const deltaTime = (time - lastTime) / 1000;
      lastTime = time;

      updatePlants(deltaTime);
      drawField();

      requestAnimationFrame(gameLoop);
    };

    // Обработчики событий
    canvas.addEventListener('click', (event) => {
      const rect = canvas.getBoundingClientRect();
      const x = Math.floor((event.clientX - rect.left) / TILE_SIZE);
      const y = Math.floor((event.clientY - rect.top) / TILE_SIZE);

      if (x >= 0 && x < FIELD_WIDTH && y >= 0 && y < FIELD_HEIGHT) {
        const tile = field[y][x];
        if (tile.stage === 0 && seeds > 0) {
          tile.stage = 1;
          seeds--;
          updateUI();
        } else if (tile.stage >= 3) {
          tile.stage = 0;
          crops++;
          updateUI();
        }
      }
    });

    // Кнопки интерфейса
    document.getElementById('plantButton').addEventListener('click', () => {
      seeds += 5;
      updateUI();
    });

    document.getElementById('harvestButton').addEventListener('click', () => {
      crops = 0;
      updateUI();
    });

    // Запуск игры
    loadImages().then(() => {
      updateUI();
      requestAnimationFrame(gameLoop);
    });
  </script>
</body>
</html>
